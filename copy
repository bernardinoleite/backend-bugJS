const authHeader = request.headers.authorization
if (!authHeader) {
    throw new AppError("Token missing", 401)
}

const [, token] = authHeader.split(" ")

try {

    const { sub: user_id } = verify(token, process.env.JWT_SECRET)
    console.log(user_id);

    const userRepository = new UserRepository()
    const user = await userRepository.findById(user_id)
    if (!user) {
        throw new AppError("User does not exists")
    }
    console.log(user);

    request.user = { id: user.id }
    next()

} catch (error) {
    throw new AppError("Token Invalid", 401)
}